{"id":143,"date":"2018-01-12T23:40:04","date_gmt":"2018-01-12T22:40:04","guid":{"rendered":"https:\/\/domo.easter.fr\/?p=143"},"modified":"2018-11-30T14:33:56","modified_gmt":"2018-11-30T13:33:56","slug":"vigicrue-v3-beta","status":"publish","type":"post","link":"https:\/\/domo.easter.fr\/2018\/01\/12\/vigicrue-v3-beta\/","title":{"rendered":"Vigicrue v3 beta"},"content":{"rendered":"<p><img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-9 size-full\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture.png\" alt=\"\" width=\"983\" height=\"181\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture.png 983w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture-300x55.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture-768x141.png 768w\" sizes=\"auto, (max-width: 983px) 100vw, 983px\" \/><\/p>\n<p>Voici une nouvelle version pour le script Vigicrue.<\/p>\n<p>Suite \u00e0 une demande de <a href=\"http:\/\/easydomoticz.com\/forum\/memberlist.php?mode=viewprofile&amp;u=794\">balajol<\/a> sur le forum d&rsquo;<a href=\"http:\/\/easydomoticz.com\/forum\/viewtopic.php?f=17&amp;t=5484&amp;start=10#p46650\">easydomoticz<\/a>, j&rsquo;ai rajouter la possibilit\u00e9 d&rsquo;\u00eatre notifi\u00e9.<\/p>\n<p>J&rsquo;ai fait le test de mettre une notification sur le sensor Domoticz et \u00e7a ne semble pas fonctionner.<\/p>\n<p>Du coup je l&rsquo;ai ajout\u00e9 dans le script, j&rsquo;ai modifi\u00e9 la fa\u00e7on de le configurer aussi.<\/p>\n<p>Dans un premier temps, il faut construire le fichier de configuration au format json.<\/p>\n<p>J&rsquo;ai mis sur github trois fichiers de conf diff\u00e9rents pour le moment, <a href=\"https:\/\/github.com\/chatainsim\/scripts_domoticz\/blob\/master\/vigicrue\/conf_samples\/vigicrue_1_station.json\">un pour une station<\/a>, <a href=\"https:\/\/github.com\/chatainsim\/scripts_domoticz\/blob\/master\/vigicrue\/conf_samples\/vigicrue_2_station.json\">un pour deux stations<\/a> et <a href=\"https:\/\/github.com\/chatainsim\/scripts_domoticz\/blob\/master\/vigicrue\/conf_samples\/vigicrue_3_station.json\">pour trois stations<\/a>.<\/p>\n<p>Si vous voulez une exemple de fichier de conf pour plus de deux stations, je peux vous le faire, demandez moi.<\/p>\n<p>&nbsp;<\/p>\n<p>Voici \u00e0 quoi un fichier de configuration ressemble (je pars sur le deux stations comme c&rsquo;est celui que j&rsquo;utilise) :<\/p>\n<p>[pastacode lang=\u00a0\u00bbmarkup\u00a0\u00bb user=\u00a0\u00bbchatainsim\u00a0\u00bb repos=\u00a0\u00bbscripts_domoticz\u00a0\u00bb path_id=\u00a0\u00bbvigicrue\/conf_samples\/vigicrue_2_station.json\u00a0\u00bb revision=\u00a0\u00bb\u00a0\u00bb highlight=\u00a0\u00bb\u00a0\u00bb lines=\u00a0\u00bb\u00a0\u00bb provider=\u00a0\u00bbgithub\u00a0\u00bb\/]<\/p>\n<p>Il faut mettre le fichier de conf a un endroit accessible par Domoticz, je l&rsquo;ai mis dans <strong>\/opt\/domoticz\/scripts<\/strong> mais vous pouvez le mettre ailleurs du moment que Domoticz a les droits pour le lire.<\/p>\n<p>Une pr\u00e9cision, dans la partie notification, la valeur <strong>test<\/strong> ne sert \u00e0 rien pour l&rsquo;instant mais je compte l&rsquo;utiliser pour choisir le mode de test, plus grand que, plus grand ou equal, plus petit, etc &#8230;<\/p>\n<p>Dites moi si c&rsquo;est pertinant ou si le plus grand que suffit.<\/p>\n<p>Dans notification, <strong>value<\/strong> permet de d\u00e9finir le seuil, par exemple si le niveau d&rsquo;eau d\u00e9passe 2 m\u00e9tres ou 500 m3\/s et <strong>active<\/strong> pour activer ou non la notification (true ou false).<\/p>\n<p>&nbsp;<\/p>\n<p>Voici le script lua, cat\u00e9gorie lua -&gt; time :<\/p>\n<p>[pastacode lang=\u00a0\u00bbc\u00a0\u00bb user=\u00a0\u00bbchatainsim\u00a0\u00bb repos=\u00a0\u00bbscripts_domoticz\u00a0\u00bb path_id=\u00a0\u00bbvigicrue\/vigicrue.lua\u00a0\u00bb revision=\u00a0\u00bb\u00a0\u00bb highlight=\u00a0\u00bb\u00a0\u00bb lines=\u00a0\u00bb\u00a0\u00bb provider=\u00a0\u00bbgithub\u00a0\u00bb\/]<\/p>\n<p>Les modifications a apporter au script sont les quatre premi\u00e8res variables, \u00e0 savoir :<\/p>\n<p><strong>debug<\/strong> : Pour activer le mode debug qui affiche plus d&rsquo;info (pas encore optimis\u00e9 pour la v3)<\/p>\n<p><strong>config<\/strong> : Emplacement de votre fichier json de configuration<\/p>\n<p><strong>json<\/strong> : Emplacement de votre fichier JSON.lua<\/p>\n<p><strong>curl<\/strong> : Chemin complet vers votre binaire curl<\/p>\n<p>&nbsp;<\/p>\n<p>Pour le moment il faut modifier les commandes de notification manuellement :<\/p>\n<p>[pastacode lang=\u00a0\u00bbc\u00a0\u00bb manual=\u00a0\u00bbcommandArray%5B&rsquo;SendNotification&rsquo;%5D%3D&rsquo;Water%20level%20is%20high%20for%20station%20&prime;..StationName..&rsquo;%23Current%20level%20is%20&prime;..ResultHeight%5B%23ResultHeight%5D%5B2%5D..&rsquo;m%20for%20&prime;..StationName..&rsquo;%230%23sound%23extradata%23telegram&rsquo;%0AcommandArray%5B&rsquo;SendNotification&rsquo;%5D%3D&rsquo;Water%20speed%20level%20is%20high%20for%20station%20&prime;..StationName..&rsquo;%23Current%20speed%20level%3A%20&prime;..ResultSpeed%5B%23ResultSpeed%5D%5B2%5D..&rsquo;m3%2Fs%20for%20&prime;..StationName..&rsquo;%230%23sound%23extradata%23telegram'\u00a0\u00bb message=\u00a0\u00bb\u00a0\u00bb highlight=\u00a0\u00bb\u00a0\u00bb provider=\u00a0\u00bbmanual\u00a0\u00bb\/]<\/p>\n<p>Pour d\u00e9finir le type de notification, ici j&rsquo;utilise telegram.<\/p>\n<p>Mais je compte rajouter \u00e7a dans le fichier de conf prochainement.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Voici une nouvelle version pour le script Vigicrue. Suite \u00e0 une demande de balajol sur le forum d&rsquo;easydomoticz, j&rsquo;ai rajouter la possibilit\u00e9 d&rsquo;\u00eatre notifi\u00e9. J&rsquo;ai fait le test de mettre une notification sur le sensor Domoticz et \u00e7a ne semble pas fonctionner. Du coup je l&rsquo;ai ajout\u00e9 dans le script, j&rsquo;ai modifi\u00e9 la fa\u00e7on de [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":212,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_crdt_document":"","site-container-style":"default","site-container-layout":"default","site-sidebar-layout":"default","site-transparent-header":"default","disable-article-header":"default","disable-site-header":"default","disable-site-footer":"default","disable-content-area-spacing":"default","iawp_total_views":50,"footnotes":""},"categories":[2,4,12,13],"tags":[],"class_list":["post-143","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","category-domoticz","category-lua","category-notification","category-vigicrue"],"_links":{"self":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/143","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/comments?post=143"}],"version-history":[{"count":13,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/143\/revisions"}],"predecessor-version":[{"id":161,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/143\/revisions\/161"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/media\/212"}],"wp:attachment":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/media?parent=143"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/categories?post=143"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/tags?post=143"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}