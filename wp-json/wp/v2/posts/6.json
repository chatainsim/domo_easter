{"id":6,"date":"2017-02-09T10:44:53","date_gmt":"2017-02-09T09:44:53","guid":{"rendered":"https:\/\/domo.easter.fr\/?p=6"},"modified":"2018-11-30T14:35:05","modified_gmt":"2018-11-30T13:35:05","slug":"vigicrue-et-domoticz","status":"publish","type":"post","link":"https:\/\/domo.easter.fr\/2017\/02\/09\/vigicrue-et-domoticz\/","title":{"rendered":"Vigicrue et Domoticz"},"content":{"rendered":"<p>\/!\\ Le site Vigicrue a chang\u00e9, il faut maintenant utiliser le script<a href=\"https:\/\/domo.easter.fr\/2017\/12\/11\/vigicrue-v2\/\"> v2 de Vigicrue ici<\/a>. Ou la v3 <a href=\"https:\/\/domo.easter.fr\/2018\/01\/12\/vigicrue-v3-beta\/\">ici<\/a>.<\/p>\n<p>Comment remonter dans Domoticz\u00a0la hauteur d&rsquo;eau ainsi que le d\u00e9bit d&rsquo;un cours d&rsquo;eau depuis le site <a href=\"https:\/\/www.vigicrues.gouv.fr\/\">Vigicrues<\/a>.<\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-9 aligncenter\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture.png\" width=\"602\" height=\"111\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture.png 983w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture-300x55.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture-768x141.png 768w\" sizes=\"auto, (max-width: 602px) 100vw, 602px\" \/><\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"wp-image-12 size-large aligncenter\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture1-1024x605.png\" width=\"600\" height=\"354\" \/><\/p>\n<p>Dans un premier temps, il faut cr\u00e9er un Hardware virtuel.<\/p>\n<p>Pour ce faire, il faut se rendre dans Setup -&gt; Hardware.<\/p>\n<p>Puis ajouter un hardware de type \u00ab\u00a0Dummy\u00a0\u00bb :<img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-20 size-full\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy-1.png\" width=\"941\" height=\"253\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy-1.png 941w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy-1-300x81.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy-1-768x206.png 768w\" sizes=\"auto, (max-width: 941px) 100vw, 941px\" \/><br \/>\nPuis cr\u00e9er deux sensors en cliquant sur Create Virtual Sensors :<img loading=\"lazy\" decoding=\"async\" class=\"wp-image-21 aligncenter\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy_vigi.png\" width=\"690\" height=\"23\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy_vigi.png 1461w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy_vigi-300x10.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy_vigi-768x25.png 768w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_capture_dummy_vigi-1024x34.png 1024w\" sizes=\"auto, (max-width: 690px) 100vw, 690px\" \/>Le premier pour la hauteur d&rsquo;eau et le deuxi\u00e8me pour le d\u00e9bit d&rsquo;eau :<img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-22\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_debeau-300x175.png\" alt=\"\" width=\"300\" height=\"175\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_debeau-300x175.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_debeau.png 532w\" sizes=\"auto, (max-width: 300px) 100vw, 300px\" \/> <img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-23\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_niveau-300x175.png\" alt=\"\" width=\"300\" height=\"175\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_niveau-300x175.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_niveau.png 528w\" sizes=\"auto, (max-width: 300px) 100vw, 300px\" \/><\/p>\n<p>Ensuite il faut aller dans Setup -&gt; Devices pour r\u00e9cup\u00e9rer les idx des deux sensors virtuels cr\u00e9er pr\u00e9c\u00e9demment et les noter dans un coin (ici 215 et 216) :<img loading=\"lazy\" decoding=\"async\" class=\"alignright wp-image-24 size-full\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_idx.png\" width=\"1156\" height=\"101\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_idx.png 1156w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_idx-300x26.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_idx-768x67.png 768w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/domo_idx-1024x89.png 1024w\" sizes=\"auto, (max-width: 1156px) 100vw, 1156px\" \/><\/p>\n<p>Avant de se lancer dans la cr\u00e9ation du script qui va r\u00e9cup\u00e9rer les valeurs et mettre \u00e0 jour Domoticz, il faut r\u00e9cup\u00e9rer les infos sur la station voulu.<\/p>\n<p>Pour cela, un petit tour sur le site Vigicrues :\u00a0<a href=\"https:\/\/www.vigicrues.gouv.fr\/\">https:\/\/www.vigicrues.gouv.fr\/<\/a><\/p>\n<p>Un petit clique sur la carte \u00e0 l\u2019endroit voulu pour zoomer \u00a0:<\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-30\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/carte_vigi-300x300.png\" alt=\"\" width=\"300\" height=\"300\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/carte_vigi-300x300.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/carte_vigi-150x150.png 150w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/carte_vigi.png 683w\" sizes=\"auto, (max-width: 300px) 100vw, 300px\" \/><\/p>\n<p>Et cliquer sur la station voulu :<\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"alignnone size-medium wp-image-31\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/vigi_detail-300x235.png\" alt=\"\" width=\"300\" height=\"235\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/vigi_detail-300x235.png 300w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/vigi_detail.png 477w\" sizes=\"auto, (max-width: 300px) 100vw, 300px\" \/><\/p>\n<p>Il faut r\u00e9cup\u00e9rer l&rsquo;id de la station dans l&rsquo;url (ici <strong>W141001001<\/strong>) :<img loading=\"lazy\" decoding=\"async\" class=\"alignnone wp-image-32 size-full\" src=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/url_vigi.png\" width=\"756\" height=\"49\" srcset=\"https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/url_vigi.png 756w, https:\/\/domo.easter.fr\/wp-content\/uploads\/2017\/02\/url_vigi-300x19.png 300w\" sizes=\"auto, (max-width: 756px) 100vw, 756px\" \/><\/p>\n<p>Vous devez maintenant cr\u00e9er sur votre serveur un script bash pour r\u00e9cup\u00e9rer les infos puis mettre \u00e0 jour Domoticz.<\/p>\n<p>[pastacode lang=\u00a0\u00bbbash\u00a0\u00bb user=\u00a0\u00bbchatainsim\u00a0\u00bb repos=\u00a0\u00bbscripts_domoticz\u00a0\u00bb path_id=\u00a0\u00bbvigicrues.sh\u00a0\u00bb revision=\u00a0\u00bbmaster\u00a0\u00bb highlight=\u00a0\u00bb\u00a0\u00bb lines=\u00a0\u00bb\u00a0\u00bb provider=\u00a0\u00bbgithub\u00a0\u00bb\/]<\/p>\n<p>On remplace l&rsquo;adresse du serveur Domoticz, l&rsquo;id de la station ainsi que les idx des deux sensors virtuels et hop le tour est jou\u00e9.<\/p>\n<p>Et hop, on l&rsquo;ajoute dans la crontab pour qu&rsquo;il soit lanc\u00e9 r\u00e9guli\u00e8rement.<\/p>\n<p>Personnellement il tourne toutes les demi-heures, \u00e0 XXh01 et XXh31.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>\/!\\ Le site Vigicrue a chang\u00e9, il faut maintenant utiliser le script v2 de Vigicrue ici. Ou la v3 ici. Comment remonter dans Domoticz\u00a0la hauteur d&rsquo;eau ainsi que le d\u00e9bit d&rsquo;un cours d&rsquo;eau depuis le site Vigicrues. Dans un premier temps, il faut cr\u00e9er un Hardware virtuel. Pour ce faire, il faut se rendre dans [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":212,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":{"_crdt_document":"","site-container-style":"default","site-container-layout":"default","site-sidebar-layout":"default","site-transparent-header":"default","disable-article-header":"default","disable-site-header":"default","disable-site-footer":"default","disable-content-area-spacing":"default","iawp_total_views":26,"footnotes":""},"categories":[7,2,13],"tags":[],"class_list":["post-6","post","type-post","status-publish","format-standard","has-post-thumbnail","hentry","category-bash","category-domoticz","category-vigicrue"],"_links":{"self":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/6","targetHints":{"allow":["GET"]}}],"collection":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/comments?post=6"}],"version-history":[{"count":22,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/6\/revisions"}],"predecessor-version":[{"id":211,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/posts\/6\/revisions\/211"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/media\/212"}],"wp:attachment":[{"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/media?parent=6"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/categories?post=6"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/domo.easter.fr\/wp-json\/wp\/v2\/tags?post=6"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}